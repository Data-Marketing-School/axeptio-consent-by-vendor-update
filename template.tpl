___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Axeptio Consent by Vendor [Update] - Data Marketing School",
  "categories": ["TAG_MANAGEMENT"],
  "brand": {
    "id": "brand_dummy",
    "displayName": "",
    "thumbnail": "data:image/png;base64,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\u003d"
  },
  "description": "Set default consent by vendor (only Meta Ads, Google Ads and Google Analytics are supported at the moment)",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

// Saisissez le code de votre modèle ici.
const log = require('logToConsole');
const updateConsentState = require('updateConsentState');
const getCookieValues = require('getCookieValues');
let axeptio_authorized_vendors = getCookieValues('axeptio_authorized_vendors', true);

let consentSettings = {
  meta_ads: 'denied',
  google_ads: 'denied',
  google_analytics: 'denied'
};
let axeptioCookie = getCookieValues('axeptio_authorized_vendors');

if(axeptioCookie){
  let cookieTable = axeptioCookie[0].split(',');
  cookieTable.forEach(x => {
    if(x === 'google_analytics'){
      consentSettings.google_analytics = 'granted';
    }
    if(x === 'google_ads'){
      consentSettings.google_ads = 'granted';
    }
    if(x === 'facebook_pixel') {
      consentSettings.meta_ads = 'granted';
    }
  });
  updateConsentState(consentSettings);
}

// Appelez data.gtmOnSuccess une fois la balise terminée.
data.gtmOnSuccess();


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "access_consent",
        "versionId": "1"
      },
      "param": [
        {
          "key": "consentTypes",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "google_analytics"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "google_ads"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "meta_ads"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "get_cookies",
        "versionId": "1"
      },
      "param": [
        {
          "key": "cookieAccess",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "cookieNames",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "axeptio_authorized_vendors"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios:
- name: Untitled test 1
  code: |-
    const mockData = {
      // Mocked field values
      'axeptio_authorized_vendors': ['%2Cgoogle_analytics%2C']
    };

    // Call runCode to run the template's code.
    runCode(mockData);

    // Verify that the tag finished successfully.
    assertApi('gtmOnSuccess').wasCalled();


___NOTES___

Created on 7/14/2023, 4:23:27 PM


